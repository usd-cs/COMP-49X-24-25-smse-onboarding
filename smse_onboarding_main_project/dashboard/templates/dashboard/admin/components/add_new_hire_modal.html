<!-- Add New Hire Modal -->
<div class="modal fade" id="addNewHireModal" tabindex="-1" aria-labelledby="addNewHireModalLabel" aria-hidden="true">
    <!-- Success Alert -->
    <div class="alert alert-success alert-dismissible fade d-none" role="alert" id="successAlert">
        <span id="successMessage">Faculty member created successfully!</span>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>

    <!-- Error Alert -->
    <div class="alert alert-danger alert-dismissible fade d-none" role="alert" id="errorAlert">
        <span id="errorMessage"></span>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>

    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addNewHireModalLabel">Add Faculty</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form method="POST" action="{% url 'dashboard:create_faculty' %}" id="addNewHireForm">
                {% csrf_token %}
                <div class="modal-body">
                    <div class="row g-3">
                        <!-- Left column -->
                        <div class="col-md-6">
                            <!-- Username -->
                            <div class="mb-3">
                                <label for="username" class="form-label required">Username</label>
                                <input type="text" class="form-control" id="username" name="username" required 
                                       placeholder="e.g., jsmith">
                                <div class="form-text">Letters, digits and @/./+/-/_ only.</div>
                            </div>

                            <!-- First name -->
                            <div class="mb-3">
                                <label for="first_name" class="form-label required">First name</label>
                                <input type="text" class="form-control" id="first_name" name="first_name" required
                                       placeholder="e.g., John">
                            </div>

                            <!-- Last name -->
                            <div class="mb-3">
                                <label for="last_name" class="form-label required">Last name</label>
                                <input type="text" class="form-control" id="last_name" name="last_name" required
                                       placeholder="e.g., Smith">
                            </div>

                            <!-- Email -->
                            <div class="mb-3">
                                <label for="email" class="form-label required">Email</label>
                                <input type="email" class="form-control" id="email" name="email" required
                                       placeholder="e.g., jsmith@ucsd.edu">
                            </div>

                            <!-- Password -->
                            <div class="mb-3">
                                <label for="password" class="form-label required">Password</label>
                                <div class="input-group">
                                    <input type="password" class="form-control" id="password" name="password" required>
                                    <button class="btn btn-outline-secondary" type="button" id="togglePassword">
                                        <i class="bi bi-eye"></i>
                                    </button>
                                </div>
                                <div class="form-text">Must be at least 8 characters.</div>
                            </div>

                            <!-- Password Confirmation -->
                            <div class="mb-3">
                                <label for="password_confirmation" class="form-label required">Confirm Password</label>
                                <div class="input-group">
                                    <input type="password" class="form-control" id="password_confirmation" name="password_confirmation" required>
                                    <button class="btn btn-outline-secondary" type="button" id="togglePasswordConfirmation">
                                        <i class="bi bi-eye"></i>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Right column -->
                        <div class="col-md-6">
                            <!-- Engineering dept -->
                            <div class="mb-3">
                                <label for="engineering_dept" class="form-label required">Department</label>
                                <select class="form-select" id="engineering_dept" name="engineering_dept" required>
                                    <option value="">Select department</option>
                                    <option value="Computer Science">Computer Science</option>
                                    <option value="Electrical Engineering">Electrical Engineering</option>
                                    <option value="Mechanical Engineering">Mechanical Engineering</option>
                                    <option value="Bioengineering">Bioengineering</option>
                                    <option value="Structural Engineering">Structural Engineering</option>
                                </select>
                            </div>

                            <!-- Job role -->
                            <div class="mb-3">
                                <label for="job_role" class="form-label required">Job Role</label>
                                <select class="form-select" id="job_role" name="job_role" required>
                                    <option value="">Select role</option>
                                    <option value="Professor">Professor</option>
                                    <option value="Associate Professor">Associate Professor</option>
                                    <option value="Assistant Professor">Assistant Professor</option>
                                    <option value="Lecturer">Lecturer</option>
                                    <option value="Researcher">Researcher</option>
                                    <option value="Staff">Staff</option>
                                </select>
                            </div>

                            <!-- Phone -->
                            <div class="mb-3">
                                <label for="phone" class="form-label required">Phone</label>
                                <input type="tel" class="form-control" id="phone" name="phone" required
                                       placeholder="e.g., 858-123-4567">
                            </div>

                            <!-- Office room -->
                            <div class="mb-3">
                                <label for="office_room" class="form-label required">Office Room</label>
                                <input type="text" class="form-control" id="office_room" name="office_room" required
                                       placeholder="e.g., SCST 2323">
                            </div>

                            <!-- Hire date -->
                            <div class="mb-3">
                                <label for="hire_date" class="form-label required">Hire Date & Time</label>
                                <div class="row">
                                    <div class="col-7">
                                        <input type="date" class="form-control" id="hire_date" name="hire_date" required>
                                    </div>
                                    <div class="col-5">
                                        <input type="time" class="form-control" id="hire_time" name="hire_time" required>
                                    </div>
                                </div>
                            </div>

                            <!-- Optional fields in an expandable section -->
                            <div class="mb-3">
                                <button class="btn btn-link p-0" type="button" data-bs-toggle="collapse" data-bs-target="#optionalFields">
                                    Show Optional Fields
                                </button>
                                <div class="collapse" id="optionalFields">
                                    <!-- Zoom phone -->
                                    <div class="mb-3 mt-3">
                                        <label for="zoom_phone" class="form-label">Zoom Phone</label>
                                        <input type="tel" class="form-control" id="zoom_phone" name="zoom_phone"
                                               placeholder="Optional">
                                    </div>

                                    <!-- Bio -->
                                    <div class="mb-3">
                                        <label for="bio" class="form-label">Bio</label>
                                        <textarea class="form-control" id="bio" name="bio" rows="2"
                                                  placeholder="Optional: Brief introduction"></textarea>
                                    </div>

                                    <!-- Checkboxes -->
                                    <div class="mb-3">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="mailing_list_status" name="mailing_list_status">
                                            <label class="form-check-label" for="mailing_list_status">
                                                Add to mailing list
                                            </label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="completed_onboarding" name="completed_onboarding">
                                            <label class="form-check-label" for="completed_onboarding">
                                                Completed onboarding
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary" id="submitBtn">Save</button>
                </div>
            </form>
        </div>
    </div>
</div>

<style>
.required:after {
    content: " *";
    color: red;
}
.modal-body {
    max-height: calc(100vh - 210px);
    overflow-y: auto;
}
.alert {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 1060;
    min-width: 300px;
}
</style>

<!-- Add New Hire Modal Script -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('addNewHireForm');
    const submitBtn = document.getElementById('submitBtn');
    const successAlert = document.getElementById('successAlert');
    const successMessage = document.getElementById('successMessage');
    const errorAlert = document.getElementById('errorAlert');
    const errorMessage = document.getElementById('errorMessage');

    // Password toggle functionality
    function setupPasswordToggle(inputId, toggleId) {
        const input = document.getElementById(inputId);
        const toggle = document.getElementById(toggleId);
        
        toggle.addEventListener('click', function() {
            const type = input.getAttribute('type') === 'password' ? 'text' : 'password';
            input.setAttribute('type', type);
            toggle.innerHTML = type === 'password' ? '<i class="bi bi-eye"></i>' : '<i class="bi bi-eye-slash"></i>';
        });
    }

    setupPasswordToggle('password', 'togglePassword');
    setupPasswordToggle('password_confirmation', 'togglePasswordConfirmation');

    // Reset form and alerts when modal is hidden
    document.getElementById('addNewHireModal').addEventListener('hidden.bs.modal', function () {
        form.reset();
        successAlert.classList.remove('show');
        successAlert.classList.add('d-none');
        errorAlert.classList.remove('show');
        errorAlert.classList.add('d-none');
    });

    form.addEventListener('submit', async function(e) {
        e.preventDefault();
        
        // Disable submit button and show loading state
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Saving...';
        
        // Hide any existing alerts
        successAlert.classList.remove('show');
        successAlert.classList.add('d-none');
        errorAlert.classList.remove('show');
        errorAlert.classList.add('d-none');
        
        // Validate passwords match
        const password = document.getElementById('password').value;
        const passwordConfirmation = document.getElementById('password_confirmation').value;
        
        if (password !== passwordConfirmation) {
            errorMessage.textContent = 'Passwords do not match.';
            errorAlert.classList.remove('d-none');
            errorAlert.classList.add('show');
            submitBtn.disabled = false;
            submitBtn.innerHTML = 'Save';
            return;
        }
        
        try {
            const formData = new FormData(this);
            const response = await fetch(this.action, {
                method: 'POST',
                body: formData,
                headers: {
                    'X-CSRFToken': formData.get('csrfmiddlewaretoken')
                }
            });

            const result = await response.json();
            
            if (response.ok && result.success) {
                // Show success message
                successMessage.textContent = result.message;
                successAlert.classList.remove('d-none');
                successAlert.classList.add('show');
                
                // Close modal and refresh page after a short delay
                setTimeout(() => {
                    bootstrap.Modal.getInstance(document.getElementById('addNewHireModal')).hide();
                    window.location.reload();
                }, 1500);
            } else {
                // Show error message
                errorMessage.textContent = result.message || 'Failed to create user. Please try again.';
                errorAlert.classList.remove('d-none');
                errorAlert.classList.add('show');
                
                // Reset submit button
                submitBtn.disabled = false;
                submitBtn.innerHTML = 'Save';
            }
        } catch (error) {
            console.error('Error:', error);
            errorMessage.textContent = 'An error occurred. Please try again.';
            errorAlert.classList.remove('d-none');
            errorAlert.classList.add('show');
            
            // Reset submit button
            submitBtn.disabled = false;
            submitBtn.innerHTML = 'Save';
        }
    });
});</script> 